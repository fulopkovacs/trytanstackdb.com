import {Link} from '@tanstack/react-router'
import {
  GHLink,
  HighLightComponent,
  ClearHighlightsButton,
} from '/src/components/tutorial'

## How do collections work?

### Syncing

By default, collections are synced with the remote source when they are first
used in a live query, and every time a mutation occurs (update, insert, delete,
etc).

Look at this beautiful image <a target="_blank" href="https://tanstack.com/db/latest/docs/guides/mutations">from the docs</a>:

![image](https://raw.githubusercontent.com/TanStack/db/main/docs/unidirectional-data-flow.png)

Great, now you get it (or read <a target="_blank" href="https://tanstack.com/db/latest/docs/guides/mutations">the docs</a> if you don't, this is just a quick guide ðŸ™ƒ).

### Defining a collection

This is how the `projectsCollection` is defined:

```ts
export const projectsCollection = createCollection(
  // We use `@tanstack/react-query` to sync the local cache with the remote db
  queryCollectionOptions({
    queryKey: ['projects'],
    // This is the function that loads all the projects
    // from the remote db and populates the local cache
    queryFn: getProjects,
    getKey: (item) => item.id,
    queryClient: TanstackQuery.getContext().queryClient,
    // This function tells tanstack-db what to do when
    // an item is updated in the collection
    onUpdate: async ({transaction}) => {
      // [..] Update logic
    },
    // You can have other keys like `onInsert`, `onDelete`, etc
    // for other common data mutations operations
  }),
)
```

<GHLink href="https://github.com/fulopkovacs/trytanstackdb.com/blob/09ae096063694c0d03cf0c6ffc93b820fce1a02c/src/collections/projects.ts#L19-L64" />


The `getProjects` function is essentially just a `fetch` request:


```ts
async function getProjects() {
  const res = await fetch("/api/projects");
  if (res.status !== 200) {
    throw new Error("Failed to fetch projects");
  }

  const data: ProjectRecord[] = await res.json();
  return data;
}
```
<GHLink href="https://github.com/fulopkovacs/trytanstackdb.com/blob/8b670ab8d08795fa9c65981ec5107046b84cb3c1/src/collections/projects.ts#L36-L44" />

### Sync engines

Here we used `@tanstack/react-query`, but you can use others like the one from <a target="_blank" href="https://tanstack.com/db/latest/docs/installation#electric-collection">`ElectricSQL`</a> for real-time syncing (e.g. for collaborative apps).
