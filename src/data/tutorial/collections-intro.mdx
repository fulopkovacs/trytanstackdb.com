import {Link} from '@tanstack/react-router'
import {GHLink, HighLightComponent, OpenAPIRequestsPanelLink} from "/src/components/tutorial"

## What are collections?

### A quick demo

Let's start with a quick demo and it'll all make sense. We have a `projects` table in our database. If you click the button below, you can see all the components that display data from this table:

<HighLightComponent h_id="project">Highlight components</HighLightComponent>

In a traditional React app, both of them would probably fetch the data they need from the server, managing their own cache. If you update something somewhere (e.g. rename a project), you need to manually update the cache, and after a while even knowing what to update becomes a challenge.

TanStack DB provides you with a new option. You can store the projects' data in a collection, and use it as a single source of truth everywhere.

In the `AppSidebar` component, we use this query to get the list of projects:

```tsx
  const { data: projects } = useLiveQuery((q) =>
    q.from({
      project: projectsCollection,
    }),
  );
```
<GHLink href="https://github.com/fulopkovacs/trytanstackdb.com/blob/5551f19041a217fd70ef406e9c96d09dc62d5eb1/src/components/AppSidebar.tsx#L31-L35" />

<HighLightComponent h_id="project_sidebar">Highlight `AppSidebar`</HighLightComponent>

On the project's page, the `EditableProjectDetails` component loads only the data relevant for the currently viewed project:

```tsx
  const {
    data: [project],
  } = useLiveQuery(
    (q) => q
        .from({ project: projectsCollection })
        .where(({ project }) => eq(project.id, projectId)),
    // This hook has a dependency array as seen below.
    // Every time the `projectId` changes (i.e. we navigate
    // to a new page), the query is executed again
    [projectId],
  );
```
<GHLink href="https://github.com/fulopkovacs/trytanstackdb.com/blob/5551f19041a217fd70ef406e9c96d09dc62d5eb1/src/components/EditableProjectDetails.tsx#L93-L104" />

<HighLightComponent h_id="project_projectPage">Highlight `RouteComponent`</HighLightComponent>

### "So many queries... Isn't that ...slow?"

Thankfully, no, and there are two reasons why.

1. Multiple queries using the same collection will sync the collection with the backend only once, and use the cache the rest of the times.
    - To check it, follow these steps:
       1. open the _"API Requests"_ panel by clicking <OpenAPIRequestsPanelLink>here</OpenAPIRequestsPanelLink>
       2. reload the page (<a href="">click here</a>)
       3. see that there is only one `GET` request to the `/api/projects` endpoint, despite having 2 components using data from the `projectsCollection`
       4. If you navigate to any other project page, you shouldn't see more requests made

        > Unless the cache needs to be revalidated (because the state has been mutated or went stale).


2. Live queries are updated incrementally (they use <a href="https://github.com/electric-sql/d2ts" target="_blank">`d2ts`</a>, a differential dataflow library)
    - this results in _sub-millisecond_ execution times (even for complex queries)
    - which means that it's BLAZING FAST!!! ⚡⚡⚡

### Querying multiple collections

Yes, you can even use `innerJoin()` and other `join` operations to query multiple collections. This demo doesn't have an example for that yet, but you can <a href="https://tanstack.com/db/latest/docs/guides/live-queries#joins" target="_blank">check the documentation</a> if you're interested.
